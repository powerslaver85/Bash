#!/bin/bash
#========================================================================================================================
#|GitBackup.sh                          				                                                                        |
#========================================================================================================================
#| ______............................_..................................................................................|
#|(_____ \..........................| |.................................................................................|
#| _____) )__.._._._._____..____.___| |._____._..._._____...............................................................|
#||  ____/ _ \| | | | ___ |/ ___)___) |(____ | | | | ___ |..............................................................|
#|| |...| |_| | | | | ____| |..|___ | |/ ___ |\ V /| ____|..............................................................|
#||_|....\___/.\___/|_____)_|..(___/.\_)_____|.\_/.|_____).CH...........................................................|
#|Powerslave industries proudly presents: your mom!.....................................................................|
#========================================================================================================================
#|Script:    GitBackup.sh     		  							                                                                      |
#|Author:    Lrd. R. Schenk				                                                                                      |
#|Category:  Development / Bash                                                                                         |
#|Date:      24/01/2015                                                                                                 |
#|Web:       http://www.powerslave.ch                                                                                   |
#|Mail:      info@powerslave.ch                                                                                         |
#|MotD:      Time to die!                                                                                               |
#|Note:      TODO: Blabla                                                                                               |
#========================================================================================================================
#TODO: Script fertigschreiben
cd /src/backupgit

ls -F . | grep / > /tmp/.gitmissing1
ssh -n git.example.com ls -F /src/git/. | grep / > /tmp/.gitmissing2
diff /tmp/.gitmissing1 /tmp/.gitmissing2 | egrep '^>' |

while read x f; do
    git clone --bare --mirror ssh://git.example.com/src/git/$$f $$f
done

rm -f /tmp/.gitmissing1 /tmp/.gitmissing2

for f in */.; do (cd $$f; echo $$f; git fetch); done
